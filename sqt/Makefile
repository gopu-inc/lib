# Makefile pour SQLT (Alpine Linux)
CC = gcc
CFLAGS = -Wall -Wextra -O2 -std=c99 -fPIC
LIBS = -lsqlite3
TARGET = libsqt.a
SO_TARGET = libsqt.so
EXAMPLES = example

# Fichiers source
SRCS = sqt.c
OBJS = $(SRCS:.c=.o)

# Cible par d√©faut
all: $(TARGET) $(SO_TARGET) $(EXAMPLES)

# Biblioth√®que statique
$(TARGET): $(OBJS)
	ar rcs $@ $(OBJS)
	@echo "‚úÖ Biblioth√®que statique cr√©√©e: $@"

# Biblioth√®que dynamique
$(SO_TARGET): $(OBJS)
	$(CC) -shared -o $@ $(OBJS) $(LIBS)
	@echo "‚úÖ Biblioth√®que dynamique cr√©√©e: $@"

# Compilation des objets
%.o: %.c sqt.h
	$(CC) $(CFLAGS) -c $< -o $@

# Exemple
example: example.c $(TARGET)
	$(CC) $(CFLAGS) -o $@ $< -L. -lsqt $(LIBS)
	@echo "‚úÖ Exemple compil√©: $@"

# Nettoyage
clean:
	rm -f $(OBJS) $(TARGET) $(SO_TARGET) $(EXAMPLES) *.db
	@echo "üßπ Nettoyage termin√©"

# Installation syst√®me (sans ldconfig)
install: $(TARGET) $(SO_TARGET)
	cp sqt.h /usr/local/include/
	cp $(TARGET) $(SO_TARGET) /usr/local/lib/
	@echo "üì¶ SQLT install√© dans /usr/local/"
	@echo "‚ö†Ô∏è  Note: ldconfig non ex√©cut√© (Alpine Linux)"

# Installation manuelle pour Alpine
install-alpine: $(TARGET) $(SO_TARGET)
	cp sqt.h /usr/include/
	cp $(TARGET) $(SO_TARGET) /usr/lib/
	@echo "üì¶ SQLT install√© dans /usr/ (Alpine)"

# D√©sinstallation
uninstall:
	rm -f /usr/local/include/sqt.h
	rm -f /usr/local/lib/libsqt.*
	rm -f /usr/include/sqt.h 2>/dev/null || true
	rm -f /usr/lib/libsqt.* 2>/dev/null || true
	@echo "üóëÔ∏è SQLT d√©sinstall√©"

# Tests rapides
test: example
	./example

.PHONY: all clean install install-alpine uninstall test